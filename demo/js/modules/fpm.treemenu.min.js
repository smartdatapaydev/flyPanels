!function(e,t){"function"==typeof define&&define.amd?define([],t(e)):"object"==typeof exports?module.exports=t(e):e.fpm_treemenu=t(e)}("undefined"!=typeof global?global:this.window||this.global,function(e){"use strict";function n(e,t){return!(void 0===e.classList||!e.classList.contains(t))}function l(){var t=document.querySelectorAll(".flypanels-treemenu a, .flypanels-button-left");document.addEventListener("keydown",function(e){n(document.querySelector("body"),"flypanels-open")&&n(document.querySelector("#flypanels-menu"),"visible")&&"Tab"===e.key&&(e.shiftKey?0===Array.prototype.indexOf.call(t,e.target)&&(t[t.length-1].focus(),e.preventDefault()):-1===Array.prototype.indexOf.call(t,e.target)&&(t[0].focus(),e.preventDefault()))})}function i(t){var e=document.querySelector("#flypanels-treemenu").getAttribute("data-json"),n=new XMLHttpRequest;n.open("GET",e,!0),n.onload=function(){var e;200<=n.status&&n.status<400?!1!==(e=function(e){try{var t=JSON.parse(e);if(t&&"object"==typeof t&&null!==t)return t}catch(e){}return console.warn("Error parsing JSON file"),!1}(n.response))&&0<e.treemenu.length?(f=e.treemenu,S("OnJSONLoaded"),t()):(S("JSONLoadError"),console.warn("JSON response empty: "+e)):(S("JSONLoadError"),console.warn("Request error: "+n.status))},n.onerror=function(){S("JSONLoadError"),console.warn("error: "+n)},n.send()}function a(e){0<e.length&&(m+='<ul role="group" aria-hidden="true" hidden>',e.forEach(function(e){var t,n="#"===e.Url||""===e.Url?"javascript:void(0)":e.Url;e.hasOwnProperty("Children")?(t={"{title}":e.Title,"{url}":n,"{count}":e.Children.length},m+=h.lihaschildren.replace(/{title}|{url}|{count}/gi,function(e){return t[e]}),a(e.Children),m+="</li>"):(t={"{title}":e.Title,"{url}":n},m+=h.linochildren.replace(/{title}|{url}/gi,function(e){return t[e]}))}),m+="</ul>")}function u(){(-1<navigator.userAgent.toLowerCase().indexOf("android")||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i))&&document.querySelector(".flypanels-treemenu").classList.add("touch");var e=document.querySelectorAll(".flypanels-treemenu li.haschildren "+d.expandHandler);c(e,function(e,t){e.addEventListener("click",function(e){var t;"false"===(t=this.parentElement.parentElement).getAttribute("aria-expanded")?(t.setAttribute("aria-expanded","true"),r(t.querySelector("a.expand"),!0),t.querySelector("ul").setAttribute("aria-hidden","false"),t.querySelector("ul").removeAttribute("hidden"),setTimeout(function(){t.classList.toggle("expanded")},d.transitiontime),S("OnExpandOpen")):(t.setAttribute("aria-expanded","false"),r(t.querySelector("a.expand"),!1),t.querySelector("ul").setAttribute("aria-hidden","true"),t.querySelector("ul").setAttribute("hidden",""),setTimeout(function(){t.classList.toggle("expanded")},d.transitiontime),S("OnExpandClose")),e.preventDefault()})})}function c(e,t,n){if("[object Object]"===Object.prototype.toString.call(e))for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.call(n,e[r],r,e);else for(var o=0,l=e.length;o<l;o++)t.call(n,e[o],o,e)}var d,s,f,p={},y=!!document.querySelector&&!!e.addEventListener,m="",h={lihaschildren:null,linochildren:null},v={expandHandler:"a.expand",onInit:function(){},onDestroy:function(){},OnExpandOpen:function(){},OnExpandClose:function(){},OnJSONLoaded:function(){},JSONLoadError:function(){},UseJSON:!1},r=function(e,t){t?e.setAttribute("aria-label",e.getAttribute("data-aria-label-active")):e.setAttribute("aria-label",e.getAttribute("data-aria-label"))},S=function(e){void 0!==d[e]&&d[e].call(s)};return p.destroy=function(){d&&(document.documentElement.classList.remove(d.initClass),document.removeEventListener("click",eventHandler,!1),d=null,S("onDestroy"))},p.init=function(e){var n,r,o,t;y&&(p.destroy(),r=e||{},o={},c(n=v,function(e,t){o[t]=n[t]}),c(r,function(e,t){o[t]=r[t]}),d=o,s=document.querySelector(d.container),d.UseJSON?(e=document.querySelector("#flypanels-treemenu li.haschildren"),t=e.querySelector("li.nochildren").parentNode,e.querySelector("ul").remove(),h.lihaschildren=e.parentNode.innerHTML.replace("</li>",""),h.linochildren=t.innerHTML,document.querySelector("#flypanels-treemenu").firstChild.remove(),i(function(e){a(f);for(var t=document.querySelector("#flypanels-treemenu");t.firstChild;)t.removeChild(t.firstChild);var n=document.createElement("div");n.innerHTML=m,t.appendChild(n.firstChild),document.querySelector("#flypanels-treemenu ul").removeAttribute("hidden"),document.querySelector("#flypanels-treemenu ul").removeAttribute("aria-hidden"),document.querySelector("#flypanels-treemenu ul").setAttribute("role","tree"),u(),l()})):(u(),l()),S("onInit"))},p});